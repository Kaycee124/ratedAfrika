<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CORS Test</title>
  <style>
    body { font-family: system-ui, Arial, Helvetica, sans-serif; margin: 24px; }
    label { display: block; margin: 12px 0 6px; font-weight: 600; }
    input[type="text"], input[type="url"] { width: 100%; max-width: 900px; padding: 8px 10px; font-size: 14px; }
    .row { margin: 8px 0 16px; }
    button { padding: 10px 16px; font-size: 14px; cursor: pointer; }
    #result { margin-top: 18px; white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .ok { color: green; }
    .err { color: red; }
    .small { color: #555; font-size: 12px; }
  </style>
  <script>
    function setDisabledState() {
      const token = document.getElementById('token').value.trim();
      document.getElementById('testBtn').disabled = token.length === 0;
    }

    function saveTokenToLocalStorage() {
      const token = document.getElementById('token').value.trim();
      try { localStorage.setItem('cors_test_token', token); } catch (_) {}
    }

    function loadTokenFromLocalStorage() {
      try {
        const saved = localStorage.getItem('cors_test_token');
        if (saved) document.getElementById('token').value = saved;
      } catch (_) {}
      setDisabledState();
    }

    async function testCORS() {
      const resultDiv = document.getElementById('result');
      const url = document.getElementById('apiUrl').value.trim();
      const token = document.getElementById('token').value.trim();
      const includeCreds = document.getElementById('includeCreds').checked;

      resultDiv.innerHTML = 'Testing...';

      const headers = {};
      if (token) headers['Authorization'] = `Bearer ${token}`;
      // Content-Type is not required for GET; omit to keep preflight minimal

      try {
        const response = await fetch(url, {
          method: 'GET',
          credentials: includeCreds ? 'include' : 'omit',
          headers,
        });

        const text = await response.text();
        let parsed;
        try { parsed = JSON.parse(text); } catch { parsed = text; }

        const statusOk = response.ok;
        resultDiv.innerHTML = `
          <div class="${statusOk ? 'ok' : 'err'}"><strong>Status:</strong> ${response.status} ${response.statusText}</div>
          <div class="small"><strong>Allowed Origin?</strong> Check Network tab â†’ OPTIONS (preflight) for access-control-* headers.</div>
          <h4>Response Body</h4>
          ${typeof parsed === 'string' ? `<pre>${parsed}</pre>` : `<pre>${JSON.stringify(parsed, null, 2)}</pre>`}
        `;
      } catch (error) {
        resultDiv.innerHTML = `
          <h3 class="err">Request Error</h3>
          <pre>${error?.message || String(error)}</pre>`;
      }
    }

    document.addEventListener('DOMContentLoaded', loadTokenFromLocalStorage);
  </script>
</head>
<body>
  <h1>CORS Test</h1>

  <label for="apiUrl">API URL</label>
  <input type="url" id="apiUrl" value="https://ratedafrika-hrkd.onrender.com/songs/578a93b0-4539-436e-a2f1-e6269215cc49" />

  <label for="token">Bearer Token</label>
  <input type="text" id="token" placeholder="Paste your JWT here" oninput="setDisabledState(); saveTokenToLocalStorage();" />

  <div class="row">
    <label><input type="checkbox" id="includeCreds" /> Include credentials (cookies)</label>
    <div class="small">Only check this if your app uses cookies; otherwise leave unchecked.</div>
  </div>

  <button id="testBtn" onclick="testCORS()" disabled>Test API Call</button>

  <div id="result"></div>
</body>
</html>